{"ast":null,"code":"import _objectSpread from\"/app/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{useLocalStorage}from'../hooks/useLocalStorage';import{TrendingUp,Save,DollarSign}from'lucide-react';import{parseTabDelimited,detectColumns,mapRowsToObjects,parseNumericValue,formatCurrency}from'../utils/dataParser';import{calculatePotencialPorTipo,calculatePotencialTotal}from'../utils/calculations';import ColumnMapper from'./ColumnMapper';import DataPreview from'./DataPreview';import{toast}from'sonner';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const OrcamentoConfig=()=>{const[produtos]=useLocalStorage('challenge_produtos',[]);const[carteiras]=useLocalStorage('carteiras_master',[]);const[orcadosPorTipo,setOrcadosPorTipo]=useLocalStorage('orcados_por_tipo',[]);const[orcadosPorCarteira,setOrcadosPorCarteira]=useLocalStorage('orcados_por_carteira',[]);const[metaPercentual,setMetaPercentual]=useLocalStorage('meta_percentual',100);// Usar localStorage para auto-save dos valores digitados\nconst[tipoOrcamentos,setTipoOrcamentos]=useLocalStorage('tipo_orcamentos_temp',{});const[inputTextCarteira,setInputTextCarteira]=useState('');const[parsedRowsCarteira,setParsedRowsCarteira]=useState([]);const[columnMappingCarteira,setColumnMappingCarteira]=useState({});const[previewDataCarteira,setPreviewDataCarteira]=useState([]);const tiposCarteira=[...new Set(carteiras.map(c=>c.tipoCarteira).filter(Boolean))];// Sincronizar com orcadosPorTipo quando houver mudanças (carregar valores salvos)\nuseEffect(()=>{if(orcadosPorTipo.length>0){setTipoOrcamentos(prev=>{const updated=_objectSpread({},prev);orcadosPorTipo.forEach(o=>{const key=\"\".concat(o.produto,\"-\").concat(o.tipoCarteira);// Só atualiza se o valor não existir ou for diferente\nif(!updated[key]||updated[key]!==o.valor){updated[key]=o.valor;}});return updated;});}},[orcadosPorTipo]);// Adicionar chaves para novos produtos quando mudarem\nuseEffect(()=>{if(produtos.length>0&&tiposCarteira.length>0){setTipoOrcamentos(prev=>{const updated=_objectSpread({},prev);produtos.forEach(produto=>{tiposCarteira.forEach(tipo=>{const key=\"\".concat(produto,\"-\").concat(tipo);if(!(key in updated)){updated[key]=0;}});});return updated;});}},[produtos,tiposCarteira,carteiras]);useEffect(()=>{if(inputTextCarteira.trim()){const rows=parseTabDelimited(inputTextCarteira);setParsedRowsCarteira(rows);const detected=detectColumns(rows,['Prefixo','Carteira','TipoCarteira','Conexao']);setColumnMappingCarteira(detected);}else{setParsedRowsCarteira([]);setColumnMappingCarteira({});setPreviewDataCarteira([]);}},[inputTextCarteira]);useEffect(()=>{if(parsedRowsCarteira.length>0&&Object.keys(columnMappingCarteira).length>0){const mapped=mapRowsToObjects(parsedRowsCarteira,columnMappingCarteira);const formatted=mapped.map(row=>({prefixo:row.Prefixo||'',carteira:row.Carteira||'',tipoCarteira:row.TipoCarteira||'',valor:parseNumericValue(row.Conexao),fatorMeta:metaPercentual}));setPreviewDataCarteira(formatted);}},[parsedRowsCarteira,columnMappingCarteira,metaPercentual]);const handleTipoOrcamentoChange=(produto,tipo,valor)=>{const key=\"\".concat(produto,\"-\").concat(tipo);setTipoOrcamentos(prev=>_objectSpread(_objectSpread({},prev),{},{[key]:parseNumericValue(valor)}));};const handleSaveTipo=()=>{const orcados=[];Object.entries(tipoOrcamentos).forEach(_ref=>{let[key,valor]=_ref;const[produto,tipoCarteira]=key.split('-');if(valor>0){orcados.push({produto,tipoCarteira,valor});}});setOrcadosPorTipo(orcados);toast.success('Orçamentos por tipo salvos com sucesso!');};const handleSaveCarteira=()=>{if(previewDataCarteira.length===0){toast.error('Nenhum dado para salvar');return;}setOrcadosPorCarteira(previewDataCarteira);setInputTextCarteira('');toast.success(\"\".concat(previewDataCarteira.length,\" or\\xE7amentos por carteira salvos!\"));};const potencialTotal=calculatePotencialTotal(carteiras,orcadosPorTipo);return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bb-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bb-card-header\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"bb-card-title\",\"data-testid\":\"orcamento-tipo-title\",children:\"Campo 3.1 \\u2014 Or\\xE7amento por Tipo de Carteira\"}),/*#__PURE__*/_jsx(\"p\",{className:\"bb-card-subtitle\",children:\"Defina o or\\xE7amento para cada tipo de carteira e produto\"})]}),produtos.length===0&&/*#__PURE__*/_jsx(\"div\",{style:{padding:'16px',background:'#fff3cd',borderRadius:'8px',color:'#856404'},children:\"Configure os produtos primeiro no Campo 1\"}),produtos.length>0&&tiposCarteira.length===0&&/*#__PURE__*/_jsx(\"div\",{style:{padding:'16px',background:'#fff3cd',borderRadius:'8px',color:'#856404'},children:\"Carregue as carteiras primeiro no Campo 2\"}),produtos.length>0&&tiposCarteira.length>0&&/*#__PURE__*/_jsxs(\"div\",{children:[produtos.map(produto=>/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'24px'},children:[/*#__PURE__*/_jsx(\"h3\",{style:{fontSize:'18px',fontWeight:600,color:'var(--bb-blue)',marginBottom:'12px'},children:produto}),/*#__PURE__*/_jsx(\"div\",{style:{overflowX:'auto'},children:/*#__PURE__*/_jsxs(\"table\",{className:\"data-table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Tipo de Carteira\"}),/*#__PURE__*/_jsx(\"th\",{style:{minWidth:'200px'},children:\"Or\\xE7ado (R$)\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:tiposCarteira.map(tipo=>{const key=\"\".concat(produto,\"-\").concat(tipo);return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:tipo}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:tipoOrcamentos[key]||'',onChange:e=>handleTipoOrcamentoChange(produto,tipo,e.target.value),className:\"bb-input\",placeholder:\"0.00\",step:\"0.01\",style:{maxWidth:'180px'}})})]},tipo);})})]})})]},produto)),/*#__PURE__*/_jsxs(\"button\",{onClick:handleSaveTipo,className:\"bb-btn bb-btn-primary\",\"data-testid\":\"save-orcamento-tipo-btn\",children:[/*#__PURE__*/_jsx(Save,{size:16}),\"Salvar Or\\xE7amentos por Tipo\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bb-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bb-card-header\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"bb-card-title\",\"data-testid\":\"orcamento-carteira-title\",children:\"Campo 3.2 \\u2014 Or\\xE7amento Por % Atingimento (por Carteira)\"}),/*#__PURE__*/_jsx(\"p\",{className:\"bb-card-subtitle\",children:\"Cole os dados de or\\xE7amento por carteira e defina o % Meta\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'24px'},children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'8px',fontWeight:600,color:'var(--bb-gray-700)'},children:\"% Meta do Desafio:\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'16px'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"range\",min:\"0\",max:\"200\",value:metaPercentual,onChange:e=>setMetaPercentual(parseInt(e.target.value)),style:{flex:1,maxWidth:'400px'}}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:metaPercentual,onChange:e=>setMetaPercentual(parseInt(e.target.value)||100),className:\"bb-input\",style:{maxWidth:'100px'},min:\"0\",max:\"200\"}),/*#__PURE__*/_jsx(\"span\",{style:{fontWeight:600,color:'var(--bb-blue)'},children:\"%\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'24px'},children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'8px',fontWeight:600,color:'var(--bb-gray-700)'},children:\"Cole os dados (TAB delimitado):\"}),/*#__PURE__*/_jsx(\"textarea\",{value:inputTextCarteira,onChange:e=>setInputTextCarteira(e.target.value),placeholder:\"Cole aqui: Prefixo, Ag\\xEAncia, Carteira, Tipo de Carteira, Conex\\xE3o/Or\\xE7ado\",className:\"bb-textarea\",rows:6,\"data-testid\":\"orcamento-carteira-textarea\"})]}),parsedRowsCarteira.length>0&&/*#__PURE__*/_jsx(ColumnMapper,{targetColumns:['Prefixo','Carteira','TipoCarteira','Conexao'],detectedMapping:columnMappingCarteira,availableColumns:parsedRowsCarteira[0]||[],onMappingChange:setColumnMappingCarteira}),previewDataCarteira.length>0&&/*#__PURE__*/_jsx(DataPreview,{data:previewDataCarteira,columns:[{key:'prefixo',label:'Prefixo'},{key:'carteira',label:'Carteira'},{key:'tipoCarteira',label:'Tipo'},{key:'valor',label:'Orçado'}],maxRows:10}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleSaveCarteira,className:\"bb-btn bb-btn-primary\",disabled:previewDataCarteira.length===0,\"data-testid\":\"save-orcamento-carteira-btn\",children:[/*#__PURE__*/_jsx(Save,{size:16}),\"Salvar Or\\xE7amentos por Carteira (\",previewDataCarteira.length,\")\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bb-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bb-card-header\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"bb-card-title\",\"data-testid\":\"potencial-title\",children:\"Campo 3.3 \\u2014 Potencial de Seguridade\"}),/*#__PURE__*/_jsx(\"p\",{className:\"bb-card-subtitle\",children:\"C\\xE1lculo autom\\xE1tico baseado em carteiras e or\\xE7amentos\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{padding:'20px',background:'linear-gradient(135deg, var(--bb-blue) 0%, var(--bb-blue-light) 100%)',borderRadius:'12px',color:'white'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'12px',marginBottom:'8px'},children:[/*#__PURE__*/_jsx(DollarSign,{size:32}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{style:{fontSize:'14px',opacity:0.9},children:\"Potencial Total de Seguridade\"}),/*#__PURE__*/_jsx(\"p\",{style:{fontSize:'32px',fontWeight:700},children:formatCurrency(potencialTotal)})]})]}),/*#__PURE__*/_jsxs(\"p\",{style:{fontSize:'13px',opacity:0.8,marginTop:'8px'},children:[carteiras.length,\" carteiras \\xD7 or\\xE7amentos por produto\"]})]}),tiposCarteira.length>0&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'16px'},children:[/*#__PURE__*/_jsx(\"h3\",{style:{fontSize:'16px',fontWeight:600,color:'var(--bb-gray-700)',marginBottom:'12px'},children:\"Potencial por Tipo de Carteira:\"}),/*#__PURE__*/_jsx(\"div\",{style:{display:'grid',gridTemplateColumns:'repeat(auto-fill, minmax(250px, 1fr))',gap:'12px'},children:tiposCarteira.map(tipo=>{const numCarteiras=carteiras.filter(c=>c.tipoCarteira===tipo).length;const potencial=calculatePotencialPorTipo(tipo,carteiras,orcadosPorTipo);return/*#__PURE__*/_jsxs(\"div\",{style:{padding:'12px',background:'var(--bb-gray-50)',borderRadius:'8px',border:'1px solid var(--bb-gray-200)'},children:[/*#__PURE__*/_jsx(\"p\",{style:{fontSize:'14px',fontWeight:600,color:'var(--bb-blue)',marginBottom:'4px'},children:tipo}),/*#__PURE__*/_jsxs(\"p\",{style:{fontSize:'13px',color:'var(--bb-gray-600)'},children:[numCarteiras,\" carteiras \\xD7 \",formatCurrency(potencial/numCarteiras||0)]}),/*#__PURE__*/_jsx(\"p\",{style:{fontSize:'16px',fontWeight:600,color:'var(--bb-gray-900)',marginTop:'4px'},children:formatCurrency(potencial)})]},tipo);})})]})]})]});};export default OrcamentoConfig;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}