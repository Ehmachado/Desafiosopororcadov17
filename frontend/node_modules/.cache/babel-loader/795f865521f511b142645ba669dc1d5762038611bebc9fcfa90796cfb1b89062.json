{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useLocalStorage}from'../hooks/useLocalStorage';import{Database,Trash2,Save}from'lucide-react';import{parseTabDelimited,detectColumns,mapRowsToObjects}from'../utils/dataParser';import ColumnMapper from'./ColumnMapper';import DataPreview from'./DataPreview';import{toast}from'sonner';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const TARGET_COLUMNS=['Prefixo','Agência','Carteira','TipoCarteira'];const CarteirasMaster=()=>{const[carteiras,setCarteiras]=useLocalStorage('carteiras_master',[]);const[inputText,setInputText]=useState('');const[parsedRows,setParsedRows]=useState([]);const[columnMapping,setColumnMapping]=useState({});const[previewData,setPreviewData]=useState([]);useEffect(()=>{if(inputText.trim()){const rows=parseTabDelimited(inputText);setParsedRows(rows);const detected=detectColumns(rows,TARGET_COLUMNS);setColumnMapping(detected);}else{setParsedRows([]);setColumnMapping({});setPreviewData([]);}},[inputText]);useEffect(()=>{if(parsedRows.length>0&&Object.keys(columnMapping).length>0){const mapped=mapRowsToObjects(parsedRows,columnMapping);const formatted=mapped.map(row=>({prefixo:row.Prefixo||'',agencia:row.Agência||'',carteira:row.Carteira||'',tipoCarteira:row.TipoCarteira||''}));setPreviewData(formatted);}},[parsedRows,columnMapping]);const handleSave=()=>{if(previewData.length===0){toast.error('Nenhum dado para salvar');return;}setCarteiras(previewData);setInputText('');toast.success(\"\".concat(previewData.length,\" carteiras salvas com sucesso!\"));};const handleClear=()=>{setCarteiras([]);setInputText('');setParsedRows([]);setColumnMapping({});setPreviewData([]);toast.success('Dados limpos');};const tiposCarteira=[...new Set(carteiras.map(c=>c.tipoCarteira).filter(Boolean))];return/*#__PURE__*/_jsxs(\"div\",{className:\"bb-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bb-card-header\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"bb-card-title\",\"data-testid\":\"carteiras-master-title\",children:\"Campo 2 \\u2014 Carteiras da Regional (Base Mestre)\"}),/*#__PURE__*/_jsx(\"p\",{className:\"bb-card-subtitle\",children:\"Cole os dados das carteiras no formato TAB/CSV\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'24px'},children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'8px',fontWeight:600,color:'var(--bb-gray-700)'},children:\"Cole os dados (TAB delimitado):\"}),/*#__PURE__*/_jsx(\"textarea\",{value:inputText,onChange:e=>setInputText(e.target.value),placeholder:\"Cole aqui os dados com colunas: Prefixo, Ag\\xEAncia/Depend\\xEAncia/Nome, Carteira, Tipo de Carteira\",className:\"bb-textarea\",rows:8,\"data-testid\":\"carteiras-textarea\"})]}),parsedRows.length>0&&/*#__PURE__*/_jsx(ColumnMapper,{targetColumns:TARGET_COLUMNS,detectedMapping:columnMapping,availableColumns:parsedRows[0]||[],onMappingChange:setColumnMapping}),previewData.length>0&&/*#__PURE__*/_jsx(DataPreview,{data:previewData,columns:[{key:'prefixo',label:'Prefixo'},{key:'agencia',label:'Agência'},{key:'carteira',label:'Carteira'},{key:'tipoCarteira',label:'Tipo de Carteira'}],maxRows:10}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'12px',marginTop:'16px'},children:[/*#__PURE__*/_jsxs(\"button\",{onClick:handleSave,className:\"bb-btn bb-btn-primary\",disabled:previewData.length===0,\"data-testid\":\"save-carteiras-btn\",children:[/*#__PURE__*/_jsx(Save,{size:16}),\"Salvar Carteiras (\",previewData.length,\")\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleClear,className:\"bb-btn bb-btn-outline\",disabled:carteiras.length===0,\"data-testid\":\"clear-carteiras-btn\",children:[/*#__PURE__*/_jsx(Trash2,{size:16}),\"Limpar Dados\"]})]}),carteiras.length>0&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'24px'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{padding:'16px',background:'var(--bb-gray-50)',borderRadius:'8px',borderLeft:'4px solid var(--bb-blue)'},children:[/*#__PURE__*/_jsxs(\"p\",{style:{fontSize:'14px',color:'var(--bb-gray-700)',marginBottom:'8px'},children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Total de carteiras:\"}),\" \",carteiras.length]}),/*#__PURE__*/_jsxs(\"p\",{style:{fontSize:'14px',color:'var(--bb-gray-700)',marginBottom:'8px'},children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Tipos de carteira:\"}),\" \",tiposCarteira.length]}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:'12px',display:'flex',flexWrap:'wrap',gap:'8px'},children:tiposCarteira.map(tipo=>/*#__PURE__*/_jsx(\"span\",{className:\"bb-badge bb-badge-info\",children:tipo},tipo))})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'16px',maxHeight:'300px',overflowY:'auto'},children:[/*#__PURE__*/_jsxs(\"table\",{className:\"data-table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Prefixo\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Ag\\xEAncia\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Carteira\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Tipo\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:carteiras.slice(0,200).map((c,idx)=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:c.prefixo}),/*#__PURE__*/_jsx(\"td\",{children:c.agencia}),/*#__PURE__*/_jsx(\"td\",{children:c.carteira}),/*#__PURE__*/_jsx(\"td\",{children:c.tipoCarteira})]},idx))})]}),carteiras.length>200&&/*#__PURE__*/_jsxs(\"p\",{style:{textAlign:'center',padding:'12px',color:'var(--bb-gray-600)',fontSize:'14px'},children:[\"Mostrando 200 de \",carteiras.length,\" carteiras\"]})]})]})]});};export default CarteirasMaster;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}