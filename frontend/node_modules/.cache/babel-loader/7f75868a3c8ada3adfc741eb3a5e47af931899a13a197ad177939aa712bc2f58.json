{"ast":null,"code":"import _objectSpread from\"/app/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useMemo}from'react';import{useLocalStorage}from'../hooks/useLocalStorage';import{Database,Save,Trash2,Calendar,TrendingUp}from'lucide-react';import{parseTabDelimited,detectColumns,mapRowsToObjects,parseNumericValue}from'../utils/dataParser';import ColumnMapper from'./ColumnMapper';import DataPreview from'./DataPreview';import{toast}from'sonner';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const TARGET_COLUMNS=['Prefixo','Carteira','TipoCarteira','Valor'];const RealizadoCarteira=()=>{const[diasDesafio]=useLocalStorage('challenge_dias',1);const[realizados,setRealizados]=useLocalStorage('realizados_carteira',[]);const[realizadosDiarios,setRealizadosDiarios]=useLocalStorage('realizados_carteira_diarios',[]);const[selectedDay,setSelectedDay]=useState(1);const[inputText,setInputText]=useState('');const[parsedRows,setParsedRows]=useState([]);const[columnMapping,setColumnMapping]=useState({});const[previewData,setPreviewData]=useState([]);useEffect(()=>{if(inputText.trim()){const rows=parseTabDelimited(inputText);setParsedRows(rows);const detected=detectColumns(rows,TARGET_COLUMNS);setColumnMapping(detected);}else{setParsedRows([]);setColumnMapping({});setPreviewData([]);}},[inputText]);useEffect(()=>{if(parsedRows.length>0&&Object.keys(columnMapping).length>0){const mapped=mapRowsToObjects(parsedRows,columnMapping);const formatted=mapped.map(row=>({prefixo:row.Prefixo||'',carteira:row.Carteira||'',tipoCarteira:row.TipoCarteira||'',valor:parseNumericValue(row.Valor)}));setPreviewData(formatted);}},[parsedRows,columnMapping]);const handleSave=()=>{if(previewData.length===0){toast.error('Nenhum dado para salvar');return;}setRealizados(previewData);setInputText('');toast.success(\"\".concat(previewData.length,\" realizados por carteira salvos!\"));};const handleSaveDiario=()=>{if(previewData.length===0){toast.error('Nenhum dado para salvar');return;}// Remove dados do mesmo dia antes de salvar\nconst updated=realizadosDiarios.filter(r=>r.dia!==selectedDay);const dailyData=previewData.map(item=>_objectSpread(_objectSpread({},item),{},{dia:selectedDay}));setRealizadosDiarios([...updated,...dailyData]);setInputText('');toast.success(\"Realizado di\\xE1rio do Dia \".concat(selectedDay,\" por carteira salvo!\"));};const handleClearDiario=()=>{const updated=realizadosDiarios.filter(r=>r.dia!==selectedDay);setRealizadosDiarios(updated);toast.success(\"Dados do Dia \".concat(selectedDay,\" por carteira removidos!\"));};// Calcular acumulado total por carteira\nconst realizadoAcumulado=useMemo(()=>{const acumulado=[];const porCarteira={};realizadosDiarios.filter(r=>r.dia<=selectedDay).forEach(r=>{const key=\"\".concat(r.prefixo,\"_\").concat(r.carteira,\"_\").concat(r.tipoCarteira);if(!porCarteira[key]){porCarteira[key]={prefixo:r.prefixo,carteira:r.carteira,tipoCarteira:r.tipoCarteira,valor:0};}porCarteira[key].valor+=r.valor;});return Object.values(porCarteira);},[realizadosDiarios,selectedDay]);return/*#__PURE__*/_jsxs(\"div\",{className:\"bb-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bb-card-header\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"bb-card-title\",\"data-testid\":\"realizado-carteira-title\",children:\"Campo 6 \\u2014 Realizado por Carteira\"}),/*#__PURE__*/_jsx(\"p\",{className:\"bb-card-subtitle\",children:\"Cole os dados de realizado por carteira\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'16px',padding:'12px',background:'#d1ecf1',borderRadius:'8px',color:'#0c5460',fontSize:'14px'},children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Importante:\"}),\" Os dados deste campo habilitam a unidade \\\"Carteiras\\\" no Ranking. Sem dados, apenas \\\"Ag\\xEAncia\\\" estar\\xE1 dispon\\xEDvel.\"]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'24px',padding:'20px',background:'linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%)',borderRadius:'12px',border:'2px solid #2196f3'},children:[/*#__PURE__*/_jsxs(\"h3\",{style:{fontSize:'18px',fontWeight:700,color:'#1565c0',marginBottom:'16px',display:'flex',alignItems:'center',gap:'8px'},children:[/*#__PURE__*/_jsx(Calendar,{size:20}),\"Controle Di\\xE1rio do Desafio\"]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'16px',alignItems:'center',flexWrap:'wrap'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'8px',fontWeight:600,color:'#1565c0'},children:\"Dia do Desafio:\"}),/*#__PURE__*/_jsx(\"select\",{value:selectedDay,onChange:e=>setSelectedDay(Number(e.target.value)),className:\"bb-input\",style:{maxWidth:'150px'},\"data-testid\":\"day-select-carteira\",children:Array.from({length:diasDesafio},(_,i)=>i+1).map(day=>/*#__PURE__*/_jsxs(\"option\",{value:day,children:[\"Dia \",day]},day))})]}),/*#__PURE__*/_jsxs(\"div\",{style:{padding:'12px 20px',background:'white',borderRadius:'8px',boxShadow:'0 2px 4px rgba(0,0,0,0.1)'},children:[/*#__PURE__*/_jsx(\"span\",{style:{fontSize:'14px',color:'#666',display:'block'},children:\"Visualizando at\\xE9:\"}),/*#__PURE__*/_jsxs(\"span\",{style:{fontSize:'20px',fontWeight:700,color:'#1565c0'},children:[\"Dia \",selectedDay,\" de \",diasDesafio]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'24px'},children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'8px',fontWeight:600,color:'var(--bb-gray-700)'},children:\"Cole os dados (TAB delimitado):\"}),/*#__PURE__*/_jsx(\"textarea\",{value:inputText,onChange:e=>setInputText(e.target.value),placeholder:\"Cole aqui: Prefixo, Carteira, Tipo de Carteira, Valor\",className:\"bb-textarea\",rows:8,\"data-testid\":\"realizado-carteira-textarea\"})]}),parsedRows.length>0&&/*#__PURE__*/_jsx(ColumnMapper,{targetColumns:TARGET_COLUMNS,detectedMapping:columnMapping,availableColumns:parsedRows[0]||[],onMappingChange:setColumnMapping}),previewData.length>0&&/*#__PURE__*/_jsx(DataPreview,{data:previewData,columns:[{key:'prefixo',label:'Prefixo'},{key:'carteira',label:'Carteira'},{key:'tipoCarteira',label:'Tipo'},{key:'valor',label:'Valor'}],maxRows:10}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'12px',flexWrap:'wrap'},children:[/*#__PURE__*/_jsxs(\"button\",{onClick:handleSaveDiario,className:\"bb-btn bb-btn-primary\",disabled:previewData.length===0,\"data-testid\":\"save-realizado-carteira-diario-btn\",children:[/*#__PURE__*/_jsx(Save,{size:16}),\"Salvar Dia \",selectedDay,\" - Carteira (\",previewData.length,\")\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleClearDiario,className:\"bb-btn\",style:{background:'#dc3545',color:'white',border:'none'},\"data-testid\":\"clear-realizado-carteira-diario-btn\",children:[/*#__PURE__*/_jsx(Trash2,{size:16}),\"Limpar Dia \",selectedDay,\" - Carteira\"]})]}),realizadoAcumulado.length>0&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'32px'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{background:'linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%)',padding:'20px',borderRadius:'12px',border:'2px solid #ff9800',marginBottom:'16px'},children:[/*#__PURE__*/_jsxs(\"h3\",{style:{fontSize:'18px',fontWeight:700,color:'#e65100',marginBottom:'8px',display:'flex',alignItems:'center',gap:'8px'},children:[/*#__PURE__*/_jsx(TrendingUp,{size:20}),\"Realizado Total Acumulado at\\xE9 Dia \",selectedDay]}),/*#__PURE__*/_jsx(\"p\",{style:{fontSize:'14px',color:'#bf360c'},children:\"Este \\xE9 o valor que ser\\xE1 usado no Ranking (Campo 8)\"})]}),/*#__PURE__*/_jsx(\"div\",{style:{overflowX:'auto'},children:/*#__PURE__*/_jsxs(\"table\",{className:\"bb-table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Prefixo\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Carteira\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Tipo Carteira\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Valor Acumulado\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:realizadoAcumulado.sort((a,b)=>a.prefixo.localeCompare(b.prefixo)).map((item,index)=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:item.prefixo}),/*#__PURE__*/_jsx(\"td\",{children:item.carteira}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"span\",{className:\"bb-badge bb-badge-primary\",children:item.tipoCarteira})}),/*#__PURE__*/_jsx(\"td\",{style:{fontWeight:600,color:'var(--bb-blue)'},children:item.valor.toLocaleString('pt-BR',{style:'currency',currency:'BRL'})})]},index))})]})})]}),realizadosDiarios.length>0&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'24px'},children:[/*#__PURE__*/_jsx(\"h3\",{style:{fontSize:'16px',fontWeight:600,color:'var(--bb-blue)',marginBottom:'12px'},children:\"Dados Di\\xE1rios Salvos\"}),/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',flexWrap:'wrap',gap:'8px'},children:Array.from({length:diasDesafio},(_,i)=>i+1).map(dia=>{const countDia=realizadosDiarios.filter(r=>r.dia===dia).length;if(countDia===0)return null;return/*#__PURE__*/_jsxs(\"span\",{className:\"bb-badge bb-badge-success\",children:[\"Dia \",dia,\": \",countDia,\" registros\"]},dia);})})]})]});};export default RealizadoCarteira;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}